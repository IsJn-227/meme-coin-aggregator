<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meme Coin WebSocket Monitor</title>
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 20px; }
        .container { max-width: 1400px; margin: 0 auto; background: white; border-radius: 20px; padding: 30px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); }
        h1 { color: #667eea; text-align: center; margin-bottom: 10px; font-size: 2.5em; }
        .subtitle { text-align: center; color: #666; margin-bottom: 30px; }
        .config-section { background: #f8f9fa; padding: 20px; border-radius: 10px; margin-bottom: 20px; }
        .config-row { display: flex; gap: 20px; margin-bottom: 15px; align-items: center; }
        .config-row label { font-weight: 600; min-width: 150px; }
        .config-row input { flex: 1; padding: 10px; border: 2px solid #ddd; border-radius: 8px; font-size: 14px; }
        .button-group { display: flex; gap: 10px; }
        button { padding: 12px 24px; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; transition: all 0.3s; }
        .btn-connect { background: #667eea; color: white; }
        .btn-connect:hover { background: #5568d3; }
        .btn-disconnect { background: #6c757d; color: white; }
        .btn-test { background: #28a745; color: white; }
        .status-bar { padding: 15px; border-radius: 10px; margin-bottom: 20px; font-weight: 600; text-align: center; }
        .status-connected { background: #d4edda; color: #155724; }
        .status-disconnected { background: #f8d7da; color: #721c24; }
        .status-connecting { background: #fff3cd; color: #856404; }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px; }
        .stat-card { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; border-radius: 10px; text-align: center; }
        .stat-label { font-size: 12px; opacity: 0.9; margin-bottom: 5px; }
        .stat-value { font-size: 32px; font-weight: bold; }
        .tokens-section { margin-top: 20px; }
        .token-card { background: #f8f9fa; padding: 15px; border-radius: 10px; margin-bottom: 10px; border-left: 4px solid #667eea; }
        .token-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .token-name { font-size: 18px; font-weight: bold; color: #333; }
        .token-ticker { background: #667eea; color: white; padding: 4px 8px; border-radius: 5px; font-size: 12px; }
        .token-stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px; font-size: 13px; }
        .token-stat { display: flex; justify-content: space-between; }
        .token-stat-label { color: #666; }
        .token-stat-value { font-weight: 600; color: #333; }
        .price-positive { color: #28a745; }
        .price-negative { color: #dc3545; }
        .logs-section { background: #1e1e1e; color: #00ff00; padding: 20px; border-radius: 10px; height: 300px; overflow-y: auto; font-family: 'Courier New', monospace; font-size: 12px; }
        .log-entry { margin-bottom: 5px; }
        .log-info { color: #00d4ff; }
        .log-error { color: #ff4444; }
        .log-warning { color: #ffaa00; }
        .log-success { color: #00ff00; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üöÄ Meme Coin Aggregator - WebSocket Monitor</h1>
        <p class="subtitle">Real-time cryptocurrency data aggregation with live updates</p>

        <div class="config-section">
            <h3>üîß Connection Configuration</h3>
            <div class="config-row">
                <label>WebSocket URL:</label>
                <input type="text" id="wsUrl" value="https://meme-coin-aggregator-e8er.onrender.com">
            </div>
            <div class="config-row">
                <label>REST API URL:</label>
                <input type="text" id="apiUrl" value="https://meme-coin-aggregator-e8er.onrender.com/api/tokens">
            </div>
            <div class="button-group">
                <button class="btn-connect" onclick="connect()">üîå Connect</button>
                <button class="btn-disconnect" onclick="disconnect()">üîå Disconnect</button>
                <button class="btn-test" onclick="testRestApi()">üß™ Test REST API</button>
            </div>
        </div>

        <div id="statusBar" class="status-bar status-disconnected">
            ‚ùå Disconnected from WebSocket
        </div>

        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-label">TOTAL UPDATES</div>
                <div class="stat-value" id="totalUpdates">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">TOKENS TRACKED</div>
                <div class="stat-value" id="tokensTracked">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">CONNECTION TIME</div>
                <div class="stat-value" id="connectionTime">0s</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">LAST UPDATE</div>
                <div class="stat-value" id="lastUpdate">Never</div>
            </div>
        </div>

        <div class="tokens-section">
            <h3>üìä Live Token Data (Top 5)</h3>
            <div id="tokensContainer"></div>
        </div>

        <div style="margin-top: 20px;">
            <h3>üìã Connection Logs</h3>
            <div class="logs-section" id="logs"></div>
        </div>
    </div>

    <script>
        let socket = null;
        let updateCount = 0;
        let connectionStart = null;
        let connectionTimer = null;

        function log(message, type = 'info') {
            const logs = document.getElementById('logs');
            const time = new Date().toLocaleTimeString();
            const colors = { info: 'log-info', error: 'log-error', warning: 'log-warning', success: 'log-success' };
            logs.innerHTML += `<div class="log-entry ${colors[type]}">[${time}] ${message}</div>`;
            logs.scrollTop = logs.scrollHeight;
        }

        function updateStatus(status, message) {
            const statusBar = document.getElementById('statusBar');
            const classes = { connected: 'status-connected', disconnected: 'status-disconnected', connecting: 'status-connecting' };
            statusBar.className = `status-bar ${classes[status]}`;
            statusBar.innerHTML = message;
        }

        function updateConnectionTime() {
            if (connectionStart) {
                const elapsed = Math.floor((Date.now() - connectionStart) / 1000);
                document.getElementById('connectionTime').textContent = elapsed + 's';
            }
        }

        function connect() {
            const url = document.getElementById('wsUrl').value;
            
            if (socket) {
                log('‚ö†Ô∏è Already connected. Disconnect first.', 'warning');
                return;
            }

            log(`üîÑ Connecting to: ${url}`, 'info');
            updateStatus('connecting', 'üîÑ Connecting...');

            socket = io(url, {
                transports: ['websocket', 'polling'],
                reconnection: true,
                reconnectionDelay: 1000,
                reconnectionAttempts: 5
            });

            socket.on('connect', () => {
                log('‚úÖ Connected! Socket ID: ' + socket.id, 'success');
                updateStatus('connected', '‚úÖ Connected - Receiving Live Updates');
                connectionStart = Date.now();
                connectionTimer = setInterval(updateConnectionTime, 1000);

                socket.emit('subscribe:tokens');
                log('üì° Subscribed to token updates', 'success');
            });

            socket.on('tokens:update', (data) => {
                updateCount++;
                log(`üìä Update #${updateCount}: ${data.tokens.length} tokens`, 'success');
                
                document.getElementById('totalUpdates').textContent = updateCount;
                document.getElementById('tokensTracked').textContent = data.tokens.length;
                document.getElementById('lastUpdate').textContent = new Date(data.timestamp).toLocaleTimeString();

                displayTokens(data.tokens.slice(0, 5));
            });

            socket.on('disconnect', (reason) => {
                log(`‚ùå Disconnected: ${reason}`, 'error');
                updateStatus('disconnected', '‚ùå Disconnected');
                if (connectionTimer) clearInterval(connectionTimer);
                connectionStart = null;
            });

            socket.on('connect_error', (error) => {
                log(`‚ùå Connection error: ${error.message}`, 'error');
                updateStatus('disconnected', '‚ùå Connection Failed');
            });
        }

        function disconnect() {
            if (socket) {
                socket.emit('unsubscribe:tokens');
                socket.disconnect();
                socket = null;
                log('üîå Disconnected', 'warning');
                updateStatus('disconnected', '‚ùå Disconnected');
                if (connectionTimer) clearInterval(connectionTimer);
                connectionStart = null;
            }
        }

        async function testRestApi() {
            const url = document.getElementById('apiUrl').value;
            log(`üß™ Testing REST API...`, 'info');
            
            try {
                const start = Date.now();
                const response = await fetch(url);
                const time = Date.now() - start;
                
                if (response.ok) {
                    const data = await response.json();
                    log(`‚úÖ REST API OK! ${time}ms, ${data.data.length} tokens`, 'success');
                    displayTokens(data.data.slice(0, 5));
                    document.getElementById('tokensTracked').textContent = data.data.length;
                } else {
                    log(`‚ùå API error: ${response.status}`, 'error');
                }
            } catch (error) {
                log(`‚ùå API failed: ${error.message}`, 'error');
            }
        }

        function displayTokens(tokens) {
            const container = document.getElementById('tokensContainer');
            container.innerHTML = tokens.map(token => `
                <div class="token-card">
                    <div class="token-header">
                        <span class="token-name">${token.token_name || 'Unknown'}</span>
                        <span class="token-ticker">${token.token_ticker || 'N/A'}</span>
                    </div>
                    <div class="token-stats">
                        <div class="token-stat">
                            <span class="token-stat-label">Price:</span>
                            <span class="token-stat-value">$${token.price_sol?.toFixed(8) || '0'}</span>
                        </div>
                        <div class="token-stat">
                            <span class="token-stat-label">24h Change:</span>
                            <span class="token-stat-value ${token.price_1hr_change >= 0 ? 'price-positive' : 'price-negative'}">
                                ${token.price_1hr_change?.toFixed(2) || '0'}%
                            </span>
                        </div>
                        <div class="token-stat">
                            <span class="token-stat-label">Volume:</span>
                            <span class="token-stat-value">${token.volume_sol?.toFixed(2) || '0'} SOL</span>
                        </div>
                        <div class="token-stat">
                            <span class="token-stat-label">Market Cap:</span>
                            <span class="token-stat-value">${token.market_cap_sol?.toFixed(2) || '0'} SOL</span>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        log('üíª Ready! Click Connect to start', 'info');
    </script>
</body>
</html>